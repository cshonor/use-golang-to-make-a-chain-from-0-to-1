# 比原链架构图说明

## 架构层次说明

### 完整架构图（7层）

```
┌─────────────────────────────────────────┐
│      用户交互层 (User Interaction)      │
│  bytomcli  |  bytom-dashboard          │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        接口层 (Interface Layer)         │
│  API Server  |  http server → mux → handler │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        内核层 (Core Layer)               │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 交易管理      │  │ BUTXO        │    │
│  │ build/sign/  │  │              │    │
│  │ submit       │  │              │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 交易池        │  │ 孤块管理      │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 智能合约      │  │ 交易验证      │    │
│  │ BVM/Equity   │  │              │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 区块验证      │  │ 数据存储      │    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        钱包层 (Wallet Layer)             │
│  密钥管理 | 公钥管理 | 账户管理          │
│  资产管理 | 地址管理 | Token管理         │
│  UTXO | 数据存储                        │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        共识层 (Consensus Layer)          │
│  PoW  |  Tensority                      │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      数据存储层 (Data Storage)           │
│  cache (accesstoken/core/discover/...)  │
│  Level DB                               │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│    P2P分布式网络层 (P2P Network)         │
│  discover | block sync | tx sync        │
│  fast broadcast                         │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        运行环境 (Runtime)                │
│  宿主机 | 云机器 | 容器                  │
└─────────────────────────────────────────┘
```

## 关键数据流

### 1. 交易创建流程
```
用户 → bytomcli → API Server → 交易管理(build)
    → 密钥管理(sign) → 交易管理(submit)
    → 交易池 → 交易验证 → 共识层 → 数据存储
```

### 2. 区块同步流程
```
P2P网络 → 区块验证 → 共识层 → 数据存储
```

### 3. 智能合约执行流程
```
用户 → API → handler → 智能合约(BVM)
    → 资产管理 → 数据存储
```


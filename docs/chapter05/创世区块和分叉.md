# 创世区块和分叉

> 第五章子文档：创世区块和区块链分叉详解

---

## 5.13 创世区块详解

### 5.13.1 创世区块是什么？

**创世区块（Genesis Block）是区块链中的第一个区块，是所有后续区块的共同祖先。**

**核心特点：**
- ✅ 创世区块通常被**硬编码**到区块链的核心代码中
- ✅ 确保所有节点都从同一个起点开始
- ✅ 保证了区块链的一致性和安全性
- ✅ **创世区块不是通过挖矿产生的，而是硬编码的**

### 5.13.2 创世区块的核心字段解析（以比原链为例）

**比原链创世区块的关键字段：**

| 字段名 | 含义与作用 | 比原链创世区块的值 |
|--------|----------|------------------|
| `bits` | 目标难度值 | 硬编码为 `2161727821137910500`，无实际挖矿意义，仅作为结构占位 |
| `difficulty` | 由 bits 计算出的直观难度值 | 用于比较不同区块的挖矿难度 |
| `hash` | 创世区块的唯一哈希值 | 整个链的起点标识 |
| `height` | 区块高度 | **创世区块高度为 0**，后续区块依次递增 |
| `nonce` | 随机数，用于挖矿 | 硬编码为 `9253507043297`，并非通过挖矿计算得出 |
| `previous_block_hash` | 父区块哈希 | 创世区块是第一个区块，因此该值为**全零的默认值** |
| `timestamp` | 区块生成时间戳 | 比原链创世区块的时间戳为 `1524549600`，对应标准时间 **2018-04-24 14:00:00**，即主网上线时间 |
| `transaction_merkle_root` | 交易默克尔树根 | 用于验证区块内交易的完整性 |
| `transaction_status_hash` | 交易状态哈希 | 用于记录和验证交易的最终状态 |
| `transactions` | 区块中包含的交易信息数组 | 包含一笔特殊的 Coinbase 交易（挖矿奖励交易） |
| `version` | 区块结构的版本号 | 用于标识协议升级 |

### 5.13.3 生成创世区块的逻辑

**当节点首次启动时：**

1. **节点会尝试从本地 LevelDB 数据库加载区块信息**
2. **如果没有找到任何区块，节点会判定自己是全新节点**
3. **根据硬编码在代码中的创世区块信息（如 `config/genesis.go` 中的代码）来初始化本地区块链**

**代码位置：** `config/genesis.go`

**核心函数：** `mainNetGenesisBlock()` 负责生成主网的创世区块

### 5.13.4 创世区块的特殊交易

**创世区块包含一笔特殊的 Coinbase 交易（挖矿奖励交易）：**

**附加信息：**
- "Information is power. -- Jan/11/2013. Computing is power. -- Apr/24/2018."
- 用于纪念 Aaron Swartz

**输出金额：**
- 1407000412.5 BTM，约 14 亿
- 为官方预留代币

**生成过程：**
1. 通过 `genesisTx()` 构造 Coinbase 交易
2. 生成交易状态默克尔根和交易默克尔根
3. 构造出完整的区块结构，包含硬编码的 Nonce、Timestamp 和 Bits 等字段

### 5.13.5 比原链的特殊说明

**重要理解：**
- 比原链中 `StatusFail` 字段为 `false` 表示交易成功
- 这与常规认知相反，需要特别注意

---

## 5.15 区块链分叉详解

### 5.15.1 分叉是什么？

**区块链分叉 = 这条链"分家"了**

**核心理解：**
- 区块链是所有人一起遵守的一套规则
- 当社区 / 开发者对"要不要改规则"吵翻了，就会分裂

### 5.15.2 软分叉（Soft Fork）

**定义：** 小改、兼容

**特点：**
- ✅ 小修小改规则
- ✅ 新老节点还能互相认
- ✅ 链还是一条，不会出新币
- ✅ 向后兼容

**比喻：** 路拓宽了，但老车还能开

**结果：** 不会分裂成两条链

### 5.15.3 硬分叉（Hard Fork）

**定义：** 大改、不兼容

**特点：**
- ✅ 规则大改，新版本不认老版本
- ✅ 可能直接分成两条独立的链
- ✅ 原来的币会凭空多出来一种新币
- ✅ 不向后兼容

**比喻：** 一条路直接劈成两条独立高速，各走各的

**结果：** 可能分裂成两条链，也可能不分

### 5.15.4 硬分叉的两种情况

**关键理解：硬分叉 = 规则不兼容，但分不分两条链 = 看社区同不同意一起升级**

#### 情况 A：硬分叉 + 全网统一 = 不分裂

**特点：**
- 新规则 ↔ 老规则确实不兼容
- 但**全网所有人一起升级**
- 所有人都同意：好，我们一起换新规则
- 老节点全部主动更新
- 最后只有一条链

**例子：**
- 以太坊大部分升级都是这种
- 拜占庭、君士坦丁堡、巴黎升级等

#### 情况 B：硬分叉 + 社区分裂 = 真・分家

**特点：**
- 新规则 ↔ 老规则不兼容
- **一半人升级，一半人不升级**
- 一部分人：我不接受新规则！我不升级！
- 另一部分人：我升级！我用新规则！
- 结果：老链继续跑 + 新链独立跑 → 两条链

**例子：**
- 以太坊 DAO 事件 → ETH/ETC 分家
- 比特币 → 比特币现金（BCH）

### 5.15.5 以太坊的关键分叉事件

#### 1. 2016.7：DAO 硬分叉（最著名）

**事件：** The DAO 合约被黑客盗走约 360 万 ETH

**社区分歧：**
- 支持回滚 → 新链：以太坊（ETH）
- 反对回滚（代码即法律）→ 原链：以太坊经典（ETC）

**结果：** 永久分裂，两条链、两种币

#### 2. 2016 年：两次修复型硬分叉（无分裂）

**Tangerine Whistle（10 月）：**
- 修复 DoS 攻击，调整 Gas 价格

**Spurious Dragon（11 月）：**
- 清理垃圾账户、防重放攻击

**特点：** 都是硬分叉但无分裂，全网统一升级

#### 3. 2017–2019：大都会系列硬分叉（无分裂）

**拜占庭（Byzantium，2017.10）：**
- 隐私、零知识证明、推迟难度炸弹

**君士坦丁堡（Constantinople，2019.2）：**
- 优化经济模型、降低 Gas 成本

**特点：** 都是硬分叉、全网统一、无新币

#### 4. 2022.9：巴黎升级（The Merge）硬分叉

**事件：** 从 PoW（挖矿）→ PoS（质押），合并信标链

**结果：**
- 少数矿工留在 PoW 链 → 出现 ETHW、ETC PoW 等分叉币
- 但主流仍是 ETH

### 5.15.6 分叉对比总结

| 类型 | 规则改动 | 兼容性 | 是否分裂 | 是否出新币 | 例子 |
|------|---------|--------|---------|-----------|------|
| **软分叉** | 小改、收紧规则 | 向后兼容 | 不会分裂 | 不会出新币 | 规则优化 |
| **硬分叉（统一）** | 大改、结构变了 | 不兼容 | 不会分裂（全网统一升级） | 不会出新币 | 以太坊大部分升级 |
| **硬分叉（分裂）** | 大改、结构变了 | 不兼容 | 会分裂成两条链 | 会出新币 | ETH/ETC、BTC/BCH |

### 5.15.7 终极总结

**一句话总结：**
- **软分叉：兼容 → 永远不分链**
- **硬分叉：不兼容 → 可能不分，也可能分**
  - 全网统一升级 → 不分
  - 社区吵翻不统一 → 分成两条链

**关键理解：**
- 硬分叉就是新规矩跟以前不兼容，是大改
- **不兼容是技术属性，分不分裂是社区选择**

**为什么硬分叉可能不会分成两条链？**
- 虽然新规则 ↔ 老规则不兼容
- 但如果全网所有人一起升级，老节点全部主动更新
- 最后只有一条链，不会分裂
- 只有社区吵翻不统一时，才会分成两条链

---

**返回**: [区块与区块链详解](./区块与区块链详解.md)


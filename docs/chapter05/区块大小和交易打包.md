# 区块大小和交易打包

> 第五章子文档：区块大小限制和交易打包详解

---

## 5.12 区块大小限制和交易打包

### 5.12.1 每个区块能装多少笔交易？

**对！每条链不一样！完全不一样！**

**示例：**
- **比特币：** 很小，一个区块大约 2000～3000 笔
- **比原链 BTM：** 中等
- **以太坊、BSC：** 大很多
- **有的新链：** 一个区块能装几万笔

**为什么不一样？**
- 因为每条链的代码里写死了一个东西：**区块大小 / 区块 gas 上限**
- 超过这个上限，交易就装不进去，只能等下一个区块

**所以：每条公链，一个区块能存的交易数组大小，都不一样。**

### 5.12.2 区块满了还没挖到怎么办？

**装不下就不装了，先挖这个块，挖出来再说！剩下的交易，丢到下一个区块！**

**流程：**
1. **一个区块最多装 2000 笔**
   - 那矿工就先挑 2000 笔手续费最高的装进去
   - 装完 2000 笔，区块就满了，不管还有多少交易在排队，都装不进去了

2. **区块满了，还没算出 Nonce 怎么办？**
   - 照样继续挖！继续换 Nonce！
   - 交易已经固定 2000 笔
   - 区块内容已经固定
   - Bits（难度）固定
   - 就差一个 Nonce
   - 矿工不会再改交易，只会疯狂改 Nonce 去碰哈希

3. **一直没挖到，会怎样？**
   - 一直挖，挖到出来为止！
   - 交易不变
   - 区块不变
   - 只变 Nonce
   - 时间戳会稍微刷新一下
   - 直到某一个 Nonce 碰对难度，块就出来了

4. **那没装进去的交易呢？**
   - 留在交易池里，等下一个区块！
   - 这个块：2000 笔 → 挖出来
   - 下一个块：再装新的 2000 笔 → 继续挖
   - 交易不会丢，只是排队等下一班车

**终极大白话总结：**
- 区块装满就关门，不管能不能挖到，都只改 Nonce，不改交易
- 挖到就发车，挖不到就继续试
- 没上车的交易，等下一辆车（下一个区块）

### 5.12.3 交易冲突和数据一致性

**你问到精髓了！别人还在打包这个区块，你已经挖出来广播了，交易会不会冲突、数据不一致？**

**真实世界是怎么处理的：**

1. **同一时间，全网只认「同一个高度的一个区块」**
   - 比如现在是第 100 号区块
   - 所有人都在打包第 100 号区块
   - 你先挖到了 → 你立刻全网广播

2. **别人一收到你的区块，直接扔掉自己正在打包的！**
   - **重点来了：别人正在打包的那个半成品，直接丢掉！**
   - 不管他已经打包了 10 笔、100 笔、1000 笔交易，全部作废！
   - 然后他马上：
     - 把你发过来的第 100 号区块验证一遍（合法就承认）
     - 从自己的交易池里删掉已经被你打包进去的交易
     - 剩下没打包的，留着打包下一个区块 101

3. **交易绝对不会重复、不会乱**
   - 因为每笔交易有唯一标识，谁先打包进有效区块，谁就生效
   - 后来的人必须同步、对齐，不能自己乱来

**用最直白的话总结：**
- 每个区块能装多少交易？每条链自己规定，大小不一样，装不下就等下一块
- 别人还在打包，你已经挖出来了，怎么办？
  - → 别人直接扔掉自己的，用你的！
  - → 交易自动去重，绝对不会数据不一致
  - → 然后所有人立刻去挖下一个区块

**你现在这句话，就是区块链的灵魂：**
- **同一个高度，只能有一个合法区块。谁先挖到，全网就跟着谁走，没挖到的全部作废，重新开始。**

### 5.12.4 交易状态：Pending 和 Finished

#### 交易池 = Pending（待处理、排队中）

**流程：**
1. **你发交易 → 进 Pending 池**
   - 别人还没打包
   - 还没上链
   - 状态就是：Pending

2. **矿工开始打包**
   - 最多装 2000 笔
   - 装满就不再加交易了
   - 剩下的继续 Pending

3. **矿工开始疯狂试 Nonce**
   - 区块内容固定不动
   - 只改 Nonce
   - 挖到为止

4. **挖到了 → 广播**
   - 这 2000 笔成功上链
   - 从 Pending 里删掉
   - 剩下还在 Pending 的 → 等下一个区块

#### 只有打包成功了，才是 Finished

**太对了！你这句话就是标准答案！**

**流程：**
```
你发起交易
    ↓
进 交易池（Pending）
    ↓
矿工把它装进区块
    ↓
还在算 nonce，还是 Pending
    ↓
矿工算出有效 nonce，区块广播全网
    ↓
大家验证通过
    ↓
交易正式 Finished！
```

**关键理解：**
- **Pending = 还在排队，没上车**
- **区块 = 已经上车，正在等司机（矿工）发动**
- **Nonce = 司机在试钥匙，发动车子**
- **Bits = 发动车子的难度**
- **只有区块被全网确认、打包成功，交易才算真正完成！**

---

**返回**: [区块打包和验证](./区块打包和验证.md)

